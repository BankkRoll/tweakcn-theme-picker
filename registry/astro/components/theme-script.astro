---
// Theme Script Component for Astro
// This script runs before any other JavaScript and applies the theme immediately
// to prevent flash of unstyled content (FOUC)
---

<script is:inline>
  const STORAGE_KEY = "tweakcn-theme";
  const DEFAULT_THEME = "default-dark";

  function getThemePreference() {
    if (typeof localStorage !== "undefined" && localStorage.getItem(STORAGE_KEY)) {
      return localStorage.getItem(STORAGE_KEY);
    }
    return DEFAULT_THEME;
  }

  function applyTheme(theme) {
    document.documentElement.setAttribute("data-theme", theme);
  }

  // Apply theme immediately
  const theme = getThemePreference();
  applyTheme(theme);

  // Listen for theme changes from React components
  if (typeof window !== "undefined") {
    window.setTheme = function(newTheme) {
      localStorage.setItem(STORAGE_KEY, newTheme);
      applyTheme(newTheme);
      window.dispatchEvent(new CustomEvent("theme-change", { detail: newTheme }));
    };
  }

  // Watch for storage changes (for multi-tab sync)
  window.addEventListener("storage", (e) => {
    if (e.key === STORAGE_KEY && e.newValue) {
      applyTheme(e.newValue);
    }
  });
</script>
